---
title: "6306-404 Case Study #1"
authors: "Michael Catalano + Hayley Horn"
date: "October 6, 2018"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
#Packages Used
library(dplyr)
library(plyr)
library(ggplot2)
library(data.table)
```
Beer preferences in the United States are ever changing, two factor that are commonly adjusted are alcohol content and bitterness. For this analysis, we have taken data 2410 craft beers and sales data from 558 US breweries to identify trends or regionality for preference.

```{r Data_Load, echo=FALSE}
#Load the Beer data semicolon delimitied text file
Beer <- data.frame(read.csv("C:/Users/hayle/Dropbox/SMU/MSDS 6306/Unit_6/beers.csv", header = TRUE, sep = ",", dec = "."))

#Load the Brewery data
Brew <- data.frame(read.csv("C:/Users/hayle/Dropbox/SMU/MSDS 6306/Unit_6/breweries.csv", header = TRUE, sep = ",", dec = "."))

#Rename for consistency and easier linking
names(Beer) <- c("Beer_Nm","Beer_ID","ABV","IBU","Brew_ID","Style","Ounces")
str(Beer)
#Should we dress up the output?
```
Colorado leads the country in breweries, followed by California, Michigan, Oregan and Texas.
```{r Data_Load, echo=FALSE}
#Count Breweries by State - answers #1
Brew_summary <- data.frame(count(Brew$State))
names(Brew_summary) <- c("State","Brew_Count")

#Mapping the Breweries, not required but could be informative. Color code by type. Tied to #1 not required
#This is not working
map('state', fill = Brew_summary$Brew_Count, col = palette()) #standard map, ugly
ggplot(data = Brew_summary, mapping = aes()) #ggplot is the nicer option, but I didn't make it so far
```

Bitterness is measured in International Business Units (IBU), and Alcohol content is measured in Let's look at the median for both measures by state
```{r merge, echo = False}
#Merge the files  - answers #2
BandBs <- (merge(Beer,Brew, by = "Brew_ID"))
head(BandBs,6)
tail(BandBs,6)

#Count the NAs in each Column - answer #3
na_BandBs <- sapply(BandBs, function(y) sum(length(which(is.na(y)))))
na_BandBs

#Compute median ABV and IBU by State  - for #4
ABV_state <- aggregate(BandBs$ABV, list(BandBs$State), median, na.rm = TRUE)
names(ABV_state) <- c("State", "ABV_Pct")
IBU_state <- aggregate(BandBs$IBU, list(BandBs$State), median, na.rm = TRUE)
names(IBU_state) <- c("State", "IBU_Pct")

#Plot the chart to compare - for #4
#Change ABV by State bars into descending order, and graph
ABV_state$State <- factor(ABV_state$State, levels = ABV_state$State[order(-ABV_state$ABV_Pct)])
ggplot(data=ABV_state , aes(x=ABV_state$State , y=ABV_state$ABV_Pct, fill=ABV_state$State)) + geom_bar(stat="identity") + labs(title="Beer ABV by State",
         x="State", y = "ABV" , fill='State') +
  theme_bw(10) +
  theme(axis.text.x=element_text(angle=90,hjust=1)) +
  theme(legend.title.align=0.5) +
  theme(plot.title = element_text(hjust = 0.5))
  ```
  
  So which state likes their beer bitter?
  ```{r Data_Load, echo=FALSE}
#Change IBU by State bars into descending order, and graph
IBU_state$State <- factor(IBU_state$State, levels = IBU_state$State[order(-IBU_state$IBUs)])
ggplot(data=IBU_state , aes(x=IBU_state$State , y=IBU_state$IBUs, fill=IBU_state$State)) + geom_bar(stat="identity") + labs(title="Beer IBUs by State",
         x="State", y = "IBUs" , fill='State') +
  theme_bw(10) +
  theme(axis.text.x=element_text(angle=90,hjust=1)) +
  theme(legend.title.align=0.5) +
  theme(plot.title = element_text(hjust = 0.5))
```

And Mainers like their beer with a higher alcohol content.
```{r Max ABV, echo=FALSE}
#Which state has the maximum alcoholic (ABV) beer? Which state has the most bitter (IBU) beer? - for #5
library("data.table")
ABV_state_sorted <- setorderv(ABV_state, "ABV_Pct")[]
tail(ABV_state_sorted,2)
#There were two states with the highest ABV- DC and KY
IBU_state_sorted <- setorderv(IBU_state, "IBUs")[]
tail(IBU_state_sorted,1)
#The state with the highest IBU is ME
```
Something about summary data here
```{r Summary Statistics, echo=FALSE}
#Summary Statistics - for #6
summary(ABV_state$ABV_Pct)
```
Need to run scatterplot and comment on findings
```{r Scatterplot, echo=FALSE}
#Scatterplot of bitterness and alcohol content 
#Re-combine ABV and IBU tables
ABV_IBU_combined <- (merge(ABV_state,IBU_state, by = "State"))
#Plot the scatterplot
  ggplot(ABV_IBU_combined, aes(x=IBUs, y=ABV_Pct)) + 
  geom_point()+
  geom_smooth(method=lm) +
  ylab("ABV") + labs(title="ABV and IBU Scatter Plot") + theme(plot.title = element_text(hjust = 0.5))
```
The study showed a weak correlation between ABV and IBUs using scatter plot and correlation formula (0.282)
```{r correlation, echo=FALSE}
# Calculate correlation between ABV and IBUs
# First we remove the N/A IBU value from SD
ABV_IBU_combined_nona <- ABV_IBU_combined[-42,]
cor(ABV_IBU_combined_nona$ABV_Pct, ABV_IBU_combined_nona$IBUs)
```
